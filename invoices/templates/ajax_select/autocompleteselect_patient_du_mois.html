<span id="{{ html_id }}_wrapper">
<input type="text" name="{{ name }}_text" id="{{ html_id }}_text" value="" autocomplete="off" {{ extra_attrs }} />
    {% if add_link %}
        <a href="{{ add_link }}" class="add-another addlink" id="add_{{ html_id }}"
           onclick="return showAddAnotherPopup(this);"> add</a>
    {% endif %}
    <input type="hidden" name="{{ name }}" id="{{ html_id }}" value="{{ current_id }}"
           data-ajax-select="autocompleteselect" data-plugin-options="{{ data_plugin_options }}"/>
<div id="{{ html_id }}_on_deck" class="results_on_deck"><div>{{ current_repr|safe }}</div></div>

    {% block extra_script %}
        <script type="text/javascript">
            $(function() {
                var $inp = $('#{{ html_id }}');
                var opts = JSON.parse($inp.attr('data-plugin-options'));
                // Do not activate empty-form inline rows.
                // These are cloned into the form when adding another row and will be activated at that time.
                if ($inp.attr('id').indexOf('__prefix__') !== -1) {
                    return;
                }

                var url = opts['source'];
                opts['source'] = function(request, response) {
                    $.ajax({
                        url: url,
                        dataType: "json",
                        data: {
                            term: request.term,
                            is_private: $('#id_is_private').prop('checked')
                        },
                        success: function(data) {
                            response(data);
                        }
                    });
                };
                $inp.autocomplete('destroy');
                $inp.autocompleteselectmultiple(opts);
                $inp.data('_ajax_select_inited_', true);
            });
        </script>
    {% endblock %}

    {% block help %}{% if help_text %}<p class="help">{{ help_text }}</p>{% endif %}{% endblock %}
</span>
